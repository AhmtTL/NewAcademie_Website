import{x as W,l as F,c as b,o as v,a as o,u as l,g as G,w as C,b as e,t as _,S as B,d as i,f as E,i as z,F as M,r as N,j as J,h as D,k as H,v as X,p as Q,n as A,q as Y}from"./app-CujCkvLJ.js";import{_ as Z}from"./AdminLayout-Cw2MKWdw.js";import{_ as g,a as h,b as p}from"./TextInput-BgL-P8ez.js";import{P as ee}from"./PrimaryButton-B-OuZ4ev.js";import"./BaseLayout-Czs18eZX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"py-12"},se={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},le={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},oe={class:"p-6 bg-white border-b border-gray-200"},ae={class:"flex items-center justify-between mb-6"},re={class:"text-2xl font-bold text-gray-900"},ie={class:"space-x-2"},ne={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},de=["value"],me={class:"bg-purple-50 border border-purple-200 rounded-lg p-4"},ue={class:"flex items-center"},ce={key:0,class:"mt-3 p-3 bg-white border border-purple-200 rounded"},ge={class:"mt-2 space-y-4"},pe={key:0,class:"relative"},fe=["src","alt"],be={class:"flex items-center space-x-4"},ve=["disabled"],ye={key:0,class:"flex items-center text-blue-600"},xe={class:"border-t border-gray-200 pt-4"},he={class:"mt-2 space-y-2"},ke={class:"flex-1 px-3 py-2 bg-gray-100 rounded"},we=["onClick"],_e={class:"flex space-x-2"},Ve={class:"bg-orange-50 border border-orange-200 rounded-lg p-6"},Se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ue={key:0,class:"mt-4 p-4 bg-white rounded-lg border border-orange-200"},Fe={class:"flex items-center justify-between text-sm"},Ce={class:"mt-2 w-full bg-gray-200 rounded-full h-2"},De={class:"flex items-center justify-end"},Ie={__name:"Edit",props:{program:Object,categories:Array},setup(V){const r=V,s=W({title:r.program.title,slug:r.program.slug,description:r.program.description,price:r.program.price,duration:r.program.duration,category:r.program.category,image:r.program.image,features:r.program.features||[],available_tickets:r.program.available_tickets,sold_tickets:r.program.sold_tickets,is_workshop:r.program.is_workshop||!1,workshop_description:r.program.workshop_description||"",workshop_highlights:r.program.workshop_highlights||[],instructor_name:r.program.instructor_name||"",instructor_title:r.program.instructor_title||"",instructor_image:r.program.instructor_image||"",accreditations:r.program.accreditations||[],base_price:r.program.base_price||r.program.price}),k=F(""),$=F(null),S=F(!1),U=F(r.program.image||null),I=()=>{k.value.trim()&&(s.features.push(k.value.trim()),k.value="")},O=d=>{s.features.splice(d,1)},R=(d,t=1500)=>new Promise(a=>{const n=document.createElement("canvas"),c=n.getContext("2d"),y=new Image;y.onload=()=>{let{width:m,height:u}=y;m>u?m>1200&&(u=u*1200/m,m=1200):u>1200&&(m=m*1200/u,u=1200),n.width=m,n.height=u,c.drawImage(y,0,0,m,u);let f=.8,w;do w=n.toDataURL("image/jpeg",f),f-=.1;while(w.length>t*1024*1.37&&f>.1);n.toBlob(j=>{const P=new File([j],d.name,{type:"image/jpeg",lastModified:Date.now()});a(P)},"image/jpeg",f)},y.src=URL.createObjectURL(d)}),q=async d=>{const t=d.target.files[0];if(!t)return;const a=(t.size/1024/1024).toFixed(1);console.log(`Original file: ${a}MB`);let n=t;if(t.size>1.5*1024*1024){console.log("Compressing image..."),n=await R(t);const c=(n.size/1024/1024).toFixed(1);console.log(`Compressed to: ${c}MB`)}$.value=n,S.value=!0;try{const c=new FormData;c.append("image",n),c.append("type","program");const y=document.querySelector('meta[name="csrf-token"]'),x=y==null?void 0:y.getAttribute("content");console.log("CSRF Token found:",x?"Yes":"No"),console.log("CSRF Token length:",(x==null?void 0:x.length)||0),x&&c.append("_token",x);const m=await fetch(route("admin.images.upload"),{method:"POST",body:c,headers:{"X-CSRF-TOKEN":x||"",Accept:"application/json"}});if(!m.ok){const f=await m.json().catch(()=>({message:`HTTP ${m.status}`}));console.error("Upload failed:",m.status,f),console.log("Full error response:",JSON.stringify(f,null,2));let w=f.message||`Server error (${m.status})`;if(f.errors){const j=Object.entries(f.errors).map(([P,T])=>`${P}: ${Array.isArray(T)?T.join(", "):T}`).join(`
`);w+=`

Details:
`+j}alert("Failed to upload image: "+w);return}const u=await m.json();u.success?(s.image=u.data.url,U.value=u.data.url,alert("Image uploaded and optimized successfully!")):alert("Failed to upload image: "+u.message)}catch(c){console.error("Image upload error:",c),alert("Failed to upload image: "+(c.message||"Network error"))}finally{S.value=!1}},L=async()=>{if(!(!s.image||!confirm("Are you sure you want to delete this image?")))try{const d=document.querySelector('meta[name="csrf-token"]'),t=d?d.getAttribute("content"):null,n=await(await fetch(route("admin.images.delete"),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t||"",Accept:"application/json"},body:JSON.stringify({path:s.image})})).json();n.success?(s.image="",U.value=null,alert("Image deleted successfully!")):alert("Failed to delete image: "+n.message)}catch(d){console.error("Image delete error:",d),alert("Failed to delete image: "+(d.message||"Network error"))}},K=()=>{s.put(route("admin.programs.update",r.program.id))};return(d,t)=>(v(),b(M,null,[o(l(G),{title:"Edit Program"}),o(Z,null,{default:C(()=>[e("div",te,[e("div",se,[e("div",le,[e("div",oe,[e("div",ae,[e("h2",re,"Edit Program: "+_(V.program.title),1),e("div",ie,[o(l(B),{href:d.route("admin.programs.show",V.program.id),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"},{default:C(()=>t[11]||(t[11]=[i(" View Program ")])),_:1,__:[11]},8,["href"]),o(l(B),{href:d.route("admin.programs.index"),class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"},{default:C(()=>t[12]||(t[12]=[i(" Back to Programs ")])),_:1,__:[12]},8,["href"])])]),e("form",{onSubmit:E(K,["prevent"]),class:"space-y-6"},[e("div",ne,[e("div",null,[o(g,{for:"title",value:"Program Title"}),o(h,{id:"title",modelValue:l(s).title,"onUpdate:modelValue":t[0]||(t[0]=a=>l(s).title=a),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),o(p,{class:"mt-2",message:l(s).errors.title},null,8,["message"])]),e("div",null,[o(g,{for:"slug",value:"Slug"}),o(h,{id:"slug",modelValue:l(s).slug,"onUpdate:modelValue":t[1]||(t[1]=a=>l(s).slug=a),type:"text",class:"mt-1 block w-full"},null,8,["modelValue"]),o(p,{class:"mt-2",message:l(s).errors.slug},null,8,["message"])]),e("div",null,[o(g,{for:"price",value:"Price (USD)"}),o(h,{id:"price",modelValue:l(s).price,"onUpdate:modelValue":t[2]||(t[2]=a=>l(s).price=a),type:"number",step:"0.01",min:"0",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),o(p,{class:"mt-2",message:l(s).errors.price},null,8,["message"])]),e("div",null,[o(g,{for:"duration",value:"Duration"}),o(h,{id:"duration",modelValue:l(s).duration,"onUpdate:modelValue":t[3]||(t[3]=a=>l(s).duration=a),type:"text",class:"mt-1 block w-full",placeholder:"e.g., 8 weeks, 3 months"},null,8,["modelValue"]),o(p,{class:"mt-2",message:l(s).errors.duration},null,8,["message"])]),e("div",null,[o(g,{for:"category",value:"Category"}),z(e("select",{id:"category","onUpdate:modelValue":t[4]||(t[4]=a=>l(s).category=a),class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},[t[13]||(t[13]=e("option",{value:""},"Select a category",-1)),(v(!0),b(M,null,N(V.categories,a=>(v(),b("option",{key:a.id,value:a.name},_(a.name),9,de))),128))],512),[[J,l(s).category]]),o(p,{class:"mt-2",message:l(s).errors.category},null,8,["message"])]),e("div",null,[e("div",me,[e("label",ue,[z(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>l(s).is_workshop=a),type:"checkbox",class:"rounded border-gray-300 text-purple-600 shadow-sm focus:border-purple-300 focus:ring focus:ring-purple-200 focus:ring-opacity-50"},null,512),[[H,l(s).is_workshop]]),t[14]||(t[14]=e("span",{class:"ml-3"},[e("span",{class:"text-sm font-medium text-purple-900"},"ðŸŽ¯ Workshop Program"),e("div",{class:"text-xs text-purple-700"},"Enable multiple sessions across different locations with varying prices")],-1))]),o(p,{class:"mt-2",message:l(s).errors.is_workshop},null,8,["message"]),l(s).is_workshop?(v(),b("div",ce,t[15]||(t[15]=[e("div",{class:"text-xs text-purple-800"},[e("strong",null,"Workshop Mode:"),i(" This program can have multiple sessions in different locations. Use the "),e("strong",null,'"Workshop Sessions"'),i(" menu to add specific sessions with locations and pricing. ")],-1)]))):D("",!0)])]),e("div",null,[o(g,{for:"image",value:"Program Image"}),e("div",ge,[U.value?(v(),b("div",pe,[e("img",{src:U.value,alt:l(s).title,class:"w-full max-w-md h-48 object-cover rounded-lg border border-gray-300"},null,8,fe),e("div",{class:"mt-2 flex items-center justify-between"},[t[16]||(t[16]=e("div",{class:"text-sm text-gray-600"}," Current image â€¢ Auto-optimized to 800x600px (4:3 ratio) ",-1)),e("button",{type:"button",onClick:L,class:"text-red-600 hover:text-red-800 text-sm font-semibold hover:bg-red-50 px-2 py-1 rounded transition-colors"}," ðŸ—‘ï¸ Delete Image ")])])):D("",!0),e("div",be,[e("input",{type:"file",id:"imageUpload",onChange:q,accept:"image/jpeg,image/png,image/jpg,image/gif,image/webp",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",disabled:S.value},null,40,ve),S.value?(v(),b("div",ye,t[17]||(t[17]=[e("svg",{class:"animate-spin h-4 w-4 mr-2",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),i(" Uploading... ")]))):D("",!0)]),t[18]||(t[18]=e("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[e("h4",{class:"text-sm font-semibold text-blue-900 mb-2"},"ðŸ“¸ Smart Image Processing:"),e("ul",{class:"text-sm text-blue-700 space-y-1"},[e("li",null,[i("â€¢ "),e("strong",null,"Auto-optimization:"),i(" Images automatically resized to 800x600px (4:3 ratio)")]),e("li",null,[i("â€¢ "),e("strong",null,"Format conversion:"),i(" All images converted to WebP for optimal performance")]),e("li",null,[i("â€¢ "),e("strong",null,"Maximum file size:"),i(" 5MB before processing")]),e("li",null,[i("â€¢ "),e("strong",null,"Supported formats:"),i(" JPEG, PNG, JPG, GIF, WebP")]),e("li",null,[i("â€¢ "),e("strong",null,"Quality:"),i(" 85% compression for perfect balance of size and quality")]),e("li",null,[i("â€¢ "),e("strong",null,"Best practice:"),i(" Upload high-resolution images - we'll optimize them!")])])],-1)),e("div",xe,[o(g,{for:"imageUrl",value:"Or enter image URL manually"}),o(h,{id:"imageUrl",modelValue:l(s).image,"onUpdate:modelValue":t[6]||(t[6]=a=>l(s).image=a),type:"url",class:"mt-1 block w-full",placeholder:"https://example.com/image.jpg"},null,8,["modelValue"])])]),o(p,{class:"mt-2",message:l(s).errors.image},null,8,["message"])])]),e("div",null,[o(g,{for:"description",value:"Description"}),z(e("textarea",{id:"description","onUpdate:modelValue":t[7]||(t[7]=a=>l(s).description=a),rows:"4",class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",placeholder:"Detailed program description..."},null,512),[[X,l(s).description]]),o(p,{class:"mt-2",message:l(s).errors.description},null,8,["message"])]),e("div",null,[o(g,{value:"Program Features"}),e("div",he,[(v(!0),b(M,null,N(l(s).features,(a,n)=>(v(),b("div",{key:n,class:"flex items-center space-x-2"},[e("span",ke,_(a),1),e("button",{type:"button",onClick:c=>O(n),class:"text-red-600 hover:text-red-800"}," Remove ",8,we)]))),128)),e("div",_e,[o(h,{modelValue:k.value,"onUpdate:modelValue":t[8]||(t[8]=a=>k.value=a),type:"text",class:"flex-1",placeholder:"Add a feature...",onKeydown:Q(E(I,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),e("button",{type:"button",onClick:I,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"}," Add ")])]),o(p,{class:"mt-2",message:l(s).errors.features},null,8,["message"])]),e("div",Ve,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold text-orange-900 mb-4"},"ðŸŽŸï¸ Ticket Management (Scarcity Control)",-1)),e("div",Se,[e("div",null,[o(g,{for:"available_tickets",value:"Available Tickets"}),o(h,{id:"available_tickets",modelValue:l(s).available_tickets,"onUpdate:modelValue":t[9]||(t[9]=a=>l(s).available_tickets=a),type:"number",min:"0",class:"mt-1 block w-full",placeholder:"e.g., 50 (leave empty for unlimited)"},null,8,["modelValue"]),t[19]||(t[19]=e("div",{class:"mt-1 text-xs text-gray-600"}," Set a limit to create scarcity effect. Leave empty for unlimited enrollment. ",-1)),o(p,{class:"mt-2",message:l(s).errors.available_tickets},null,8,["message"])]),e("div",null,[o(g,{for:"sold_tickets",value:"Sold Tickets"}),o(h,{id:"sold_tickets",modelValue:l(s).sold_tickets,"onUpdate:modelValue":t[10]||(t[10]=a=>l(s).sold_tickets=a),type:"number",min:"0",class:"mt-1 block w-full",placeholder:"0"},null,8,["modelValue"]),t[20]||(t[20]=e("div",{class:"mt-1 text-xs text-gray-600"}," Current number of sold tickets (usually auto-managed). ",-1)),o(p,{class:"mt-2",message:l(s).errors.sold_tickets},null,8,["message"])])]),l(s).available_tickets?(v(),b("div",Ue,[e("div",Fe,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"Remaining Tickets:",-1)),e("span",{class:A(["font-bold",l(s).available_tickets-(l(s).sold_tickets||0)<=5?"text-red-600":"text-green-600"])},_(l(s).available_tickets-(l(s).sold_tickets||0))+" / "+_(l(s).available_tickets),3)]),e("div",Ce,[e("div",{class:A(["h-2 rounded-full transition-all duration-300",(l(s).sold_tickets||0)/l(s).available_tickets>.8?"bg-red-500":(l(s).sold_tickets||0)/l(s).available_tickets>.6?"bg-orange-500":"bg-green-500"]),style:Y({width:Math.min((l(s).sold_tickets||0)/l(s).available_tickets*100,100)+"%"})},null,6)])])):D("",!0)]),e("div",De,[o(ee,{class:A(["ml-4",{"opacity-25":l(s).processing}]),disabled:l(s).processing},{default:C(()=>t[23]||(t[23]=[i(" Update Program ")])),_:1,__:[23]},8,["class","disabled"])])],32)])])])])]),_:1})],64))}};export{Ie as default};
