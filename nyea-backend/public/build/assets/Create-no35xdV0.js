import{x as L,l as V,c as f,o as b,a,u as l,g as K,w as P,b as e,S as W,d as r,f as A,i as j,F as z,r as I,t as C,j as G,h as S,k as J,v as H,p as X,n as M,q as Q}from"./app-CujCkvLJ.js";import{_ as Y}from"./AdminLayout-Cw2MKWdw.js";import{_ as c,a as x,b as g}from"./TextInput-BgL-P8ez.js";import{P as Z}from"./PrimaryButton-B-OuZ4ev.js";import"./BaseLayout-Czs18eZX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"py-12"},te={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},se={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},le={class:"p-6 bg-white border-b border-gray-200"},oe={class:"flex items-center justify-between mb-6"},ae={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},re=["value"],ie={class:"bg-purple-50 border border-purple-200 rounded-lg p-4"},ne={class:"flex items-center"},de={key:0,class:"mt-3 p-3 bg-white border border-purple-200 rounded"},me={class:"mt-2 space-y-4"},ue={key:0,class:"relative"},ce=["src","alt"],ge={class:"flex items-center space-x-4"},pe=["disabled"],fe={key:0,class:"flex items-center text-blue-600"},be={class:"border-t border-gray-200 pt-4"},ve={class:"mt-2 space-y-2"},ye={class:"flex-1 px-3 py-2 bg-gray-100 rounded"},xe=["onClick"],ke={class:"flex space-x-2"},we={class:"bg-orange-50 border border-orange-200 rounded-lg p-6"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},_e={key:0,class:"mt-4 p-4 bg-white rounded-lg border border-orange-200"},Ve={class:"flex items-center justify-between text-sm"},Ce={class:"mt-2 w-full bg-gray-200 rounded-full h-2"},Se={class:"flex items-center justify-end"},Me={__name:"Create",props:{categories:Array},setup(B){const s=L({title:"",slug:"",description:"",price:"",duration:"",category:"",image:"",features:[],available_tickets:"",sold_tickets:0,is_workshop:!1,workshop_description:"",workshop_highlights:[],instructor_name:"",instructor_title:"",instructor_image:"",accreditations:[],base_price:""}),k=V(""),N=V(null),h=V(!1),_=V(null),T=()=>{k.value.trim()&&(s.features.push(k.value.trim()),k.value="")},$=d=>{s.features.splice(d,1)},R=(d,t=1500)=>new Promise(o=>{const m=document.createElement("canvas"),i=m.getContext("2d"),v=new Image;v.onload=()=>{let{width:n,height:u}=v;n>u?n>1200&&(u=u*1200/n,n=1200):u>1200&&(n=n*1200/u,u=1200),m.width=n,m.height=u,i.drawImage(v,0,0,n,u);let p=.8,w;do w=m.toDataURL("image/jpeg",p),p-=.1;while(w.length>t*1024*1.37&&p>.1);m.toBlob(F=>{const D=new File([F],d.name,{type:"image/jpeg",lastModified:Date.now()});o(D)},"image/jpeg",p)},v.src=URL.createObjectURL(d)}),E=async d=>{const t=d.target.files[0];if(!t)return;const o=(t.size/1024/1024).toFixed(1);console.log(`Original file: ${o}MB`);let m=t;if(t.size>1.5*1024*1024){console.log("Compressing image..."),m=await R(t);const i=(m.size/1024/1024).toFixed(1);console.log(`Compressed to: ${i}MB`)}N.value=m,h.value=!0;try{const i=new FormData;i.append("image",m),i.append("type","program");const v=document.querySelector('meta[name="csrf-token"]'),y=v==null?void 0:v.getAttribute("content");console.log("CSRF Token found:",y?"Yes":"No"),console.log("CSRF Token length:",(y==null?void 0:y.length)||0),y&&i.append("_token",y);const n=await fetch(route("admin.images.upload"),{method:"POST",body:i,headers:{"X-CSRF-TOKEN":y||"",Accept:"application/json"}});if(!n.ok){const p=await n.json().catch(()=>({message:`HTTP ${n.status}`}));console.error("Upload failed:",n.status,p),console.log("Full error response:",JSON.stringify(p,null,2));let w=p.message||`Server error (${n.status})`;if(p.errors){const F=Object.entries(p.errors).map(([D,U])=>`${D}: ${Array.isArray(U)?U.join(", "):U}`).join(`
`);w+=`

Details:
`+F}alert("Failed to upload image: "+w);return}const u=await n.json();u.success?(s.image=u.data.url,_.value=u.data.url,alert("Image uploaded and optimized successfully!")):alert("Failed to upload image: "+u.message)}catch(i){console.error("Image upload error:",i),alert("Failed to upload image: "+(i.message||"Network error"))}finally{h.value=!1}},O=async()=>{if(!(!s.image||!confirm("Are you sure you want to delete this image?")))try{const d=document.querySelector('meta[name="csrf-token"]'),t=d?d.getAttribute("content"):null,o={"Content-Type":"application/json"};t&&(o["X-CSRF-TOKEN"]=t);const i=await(await fetch(route("admin.images.delete"),{method:"DELETE",headers:o,body:JSON.stringify({path:s.image})})).json();i.success?(s.image="",_.value=null,alert("Image deleted successfully!")):alert("Failed to delete image: "+i.message)}catch(d){console.error("Image delete error:",d),alert("Failed to delete image: "+(d.message||"Network error"))}},q=()=>{s.post(route("admin.programs.store"))};return(d,t)=>(b(),f(z,null,[a(l(K),{title:"Create Program"}),a(Y,null,{default:P(()=>[e("div",ee,[e("div",te,[e("div",se,[e("div",le,[e("div",oe,[t[12]||(t[12]=e("h2",{class:"text-2xl font-bold text-gray-900"},"Create New Program",-1)),a(l(W),{href:d.route("admin.programs.index"),class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"},{default:P(()=>t[11]||(t[11]=[r(" Back to Programs ")])),_:1,__:[11]},8,["href"])]),e("form",{onSubmit:A(q,["prevent"]),class:"space-y-6"},[e("div",ae,[e("div",null,[a(c,{for:"title",value:"Program Title"}),a(x,{id:"title",modelValue:l(s).title,"onUpdate:modelValue":t[0]||(t[0]=o=>l(s).title=o),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),a(g,{class:"mt-2",message:l(s).errors.title},null,8,["message"])]),e("div",null,[a(c,{for:"slug",value:"Slug (optional)"}),a(x,{id:"slug",modelValue:l(s).slug,"onUpdate:modelValue":t[1]||(t[1]=o=>l(s).slug=o),type:"text",class:"mt-1 block w-full",placeholder:"auto-generated from title if empty"},null,8,["modelValue"]),a(g,{class:"mt-2",message:l(s).errors.slug},null,8,["message"])]),e("div",null,[a(c,{for:"price",value:"Price (USD)"}),a(x,{id:"price",modelValue:l(s).price,"onUpdate:modelValue":t[2]||(t[2]=o=>l(s).price=o),type:"number",step:"0.01",min:"0",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),a(g,{class:"mt-2",message:l(s).errors.price},null,8,["message"])]),e("div",null,[a(c,{for:"duration",value:"Duration"}),a(x,{id:"duration",modelValue:l(s).duration,"onUpdate:modelValue":t[3]||(t[3]=o=>l(s).duration=o),type:"text",class:"mt-1 block w-full",placeholder:"e.g., 8 weeks, 3 months"},null,8,["modelValue"]),a(g,{class:"mt-2",message:l(s).errors.duration},null,8,["message"])]),e("div",null,[a(c,{for:"category",value:"Category"}),j(e("select",{id:"category","onUpdate:modelValue":t[4]||(t[4]=o=>l(s).category=o),class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},[t[13]||(t[13]=e("option",{value:""},"Select a category",-1)),(b(!0),f(z,null,I(B.categories,o=>(b(),f("option",{key:o.id,value:o.name},C(o.name),9,re))),128))],512),[[G,l(s).category]]),a(g,{class:"mt-2",message:l(s).errors.category},null,8,["message"])]),e("div",null,[e("div",ie,[e("label",ne,[j(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>l(s).is_workshop=o),type:"checkbox",class:"rounded border-gray-300 text-purple-600 shadow-sm focus:border-purple-300 focus:ring focus:ring-purple-200 focus:ring-opacity-50"},null,512),[[J,l(s).is_workshop]]),t[14]||(t[14]=e("span",{class:"ml-3"},[e("span",{class:"text-sm font-medium text-purple-900"},"ðŸŽ¯ Workshop Program"),e("div",{class:"text-xs text-purple-700"},"Enable multiple sessions across different locations with varying prices")],-1))]),a(g,{class:"mt-2",message:l(s).errors.is_workshop},null,8,["message"]),l(s).is_workshop?(b(),f("div",de,t[15]||(t[15]=[e("div",{class:"text-xs text-purple-800"},[e("strong",null,"Workshop Mode:"),r(" After creating this program, use the "),e("strong",null,'"Workshop Sessions"'),r(" menu to add specific sessions with locations and pricing. ")],-1)]))):S("",!0)])]),e("div",null,[a(c,{for:"image",value:"Program Image"}),e("div",me,[_.value?(b(),f("div",ue,[e("img",{src:_.value,alt:l(s).title,class:"w-full max-w-md h-48 object-cover rounded-lg border border-gray-300"},null,8,ce),e("div",{class:"mt-2 flex items-center justify-between"},[t[16]||(t[16]=e("div",{class:"text-sm text-gray-600"}," Preview â€¢ Auto-optimized to 800x600px (4:3 ratio) ",-1)),e("button",{type:"button",onClick:O,class:"text-red-600 hover:text-red-800 text-sm font-semibold hover:bg-red-50 px-2 py-1 rounded transition-colors"}," ðŸ—‘ï¸ Delete Image ")])])):S("",!0),e("div",ge,[e("input",{type:"file",id:"imageUpload",onChange:E,accept:"image/jpeg,image/png,image/jpg,image/gif,image/webp",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",disabled:h.value},null,40,pe),h.value?(b(),f("div",fe,t[17]||(t[17]=[e("svg",{class:"animate-spin h-4 w-4 mr-2",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),r(" Uploading... ")]))):S("",!0)]),t[18]||(t[18]=e("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[e("h4",{class:"text-sm font-semibold text-blue-900 mb-2"},"ðŸ“¸ Smart Image Processing:"),e("ul",{class:"text-sm text-blue-700 space-y-1"},[e("li",null,[r("â€¢ "),e("strong",null,"Auto-optimization:"),r(" Images automatically resized to 800x600px (4:3 ratio)")]),e("li",null,[r("â€¢ "),e("strong",null,"Format conversion:"),r(" All images converted to WebP for optimal performance")]),e("li",null,[r("â€¢ "),e("strong",null,"Maximum file size:"),r(" 5MB before processing")]),e("li",null,[r("â€¢ "),e("strong",null,"Supported formats:"),r(" JPEG, PNG, JPG, GIF, WebP")]),e("li",null,[r("â€¢ "),e("strong",null,"Quality:"),r(" 85% compression for perfect balance of size and quality")]),e("li",null,[r("â€¢ "),e("strong",null,"Best practice:"),r(" Upload high-resolution images - we'll optimize them!")])])],-1)),e("div",be,[a(c,{for:"imageUrl",value:"Or enter image URL manually"}),a(x,{id:"imageUrl",modelValue:l(s).image,"onUpdate:modelValue":t[6]||(t[6]=o=>l(s).image=o),type:"url",class:"mt-1 block w-full",placeholder:"https://example.com/image.jpg"},null,8,["modelValue"])])]),a(g,{class:"mt-2",message:l(s).errors.image},null,8,["message"])])]),e("div",null,[a(c,{for:"description",value:"Description"}),j(e("textarea",{id:"description","onUpdate:modelValue":t[7]||(t[7]=o=>l(s).description=o),rows:"4",class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",placeholder:"Detailed program description..."},null,512),[[H,l(s).description]]),a(g,{class:"mt-2",message:l(s).errors.description},null,8,["message"])]),e("div",null,[a(c,{value:"Program Features"}),e("div",ve,[(b(!0),f(z,null,I(l(s).features,(o,m)=>(b(),f("div",{key:m,class:"flex items-center space-x-2"},[e("span",ye,C(o),1),e("button",{type:"button",onClick:i=>$(m),class:"text-red-600 hover:text-red-800"}," Remove ",8,xe)]))),128)),e("div",ke,[a(x,{modelValue:k.value,"onUpdate:modelValue":t[8]||(t[8]=o=>k.value=o),type:"text",class:"flex-1",placeholder:"Add a feature...",onKeydown:X(A(T,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),e("button",{type:"button",onClick:T,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"}," Add ")])]),a(g,{class:"mt-2",message:l(s).errors.features},null,8,["message"])]),e("div",we,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold text-orange-900 mb-4"},"ðŸŽŸï¸ Ticket Management (Scarcity Control)",-1)),e("div",he,[e("div",null,[a(c,{for:"available_tickets",value:"Available Tickets"}),a(x,{id:"available_tickets",modelValue:l(s).available_tickets,"onUpdate:modelValue":t[9]||(t[9]=o=>l(s).available_tickets=o),type:"number",min:"0",class:"mt-1 block w-full",placeholder:"e.g., 50 (leave empty for unlimited)"},null,8,["modelValue"]),t[19]||(t[19]=e("div",{class:"mt-1 text-xs text-gray-600"}," Set a limit to create scarcity effect. Leave empty for unlimited enrollment. ",-1)),a(g,{class:"mt-2",message:l(s).errors.available_tickets},null,8,["message"])]),e("div",null,[a(c,{for:"sold_tickets",value:"Sold Tickets"}),a(x,{id:"sold_tickets",modelValue:l(s).sold_tickets,"onUpdate:modelValue":t[10]||(t[10]=o=>l(s).sold_tickets=o),type:"number",min:"0",class:"mt-1 block w-full",placeholder:"0"},null,8,["modelValue"]),t[20]||(t[20]=e("div",{class:"mt-1 text-xs text-gray-600"}," Current number of sold tickets (usually starts at 0). ",-1)),a(g,{class:"mt-2",message:l(s).errors.sold_tickets},null,8,["message"])])]),l(s).available_tickets?(b(),f("div",_e,[e("div",Ve,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"Remaining Tickets:",-1)),e("span",{class:M(["font-bold",l(s).available_tickets-(l(s).sold_tickets||0)<=5?"text-red-600":"text-green-600"])},C(l(s).available_tickets-(l(s).sold_tickets||0))+" / "+C(l(s).available_tickets),3)]),e("div",Ce,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",(l(s).sold_tickets||0)/l(s).available_tickets>.8?"bg-red-500":(l(s).sold_tickets||0)/l(s).available_tickets>.6?"bg-orange-500":"bg-green-500"]),style:Q({width:Math.min((l(s).sold_tickets||0)/l(s).available_tickets*100,100)+"%"})},null,6)])])):S("",!0)]),e("div",Se,[a(Z,{class:M(["ml-4",{"opacity-25":l(s).processing}]),disabled:l(s).processing},{default:P(()=>t[23]||(t[23]=[r(" Create Program ")])),_:1,__:[23]},8,["class","disabled"])])],32)])])])])]),_:1})],64))}};export{Me as default};
